title: "SaaS Subscription Tracking"
description: "Track subscription creation events"
default_language: ruby

languages:
  ruby:
    label: "Ruby"
    syntax: "ruby"
    code: |
      class SubscriptionsController < ApplicationController
        def create
          @subscription = current_user.create_subscription!(
            plan: params[:plan]
          )

          Mbuzz.track(
            user_id: current_user.id,
            event: 'Subscription Created',
            properties: {
              plan: @subscription.plan,
              billing_cycle: @subscription.billing_cycle,
              mrr: @subscription.monthly_revenue
            }
          )

          redirect_to dashboard_path
        end
      end

  curl:
    label: "REST API"
    syntax: "bash"
    code: |
      curl -X POST <%= api_v1_events_url %> \
        -H "Authorization: Bearer $MBUZZ_API_KEY" \
        -H "Content-Type: application/json" \
        -d '{
          "user_id": "123",
          "event": "Subscription Created",
          "properties": {
            "plan": "pro",
            "billing_cycle": "monthly",
            "mrr": 49.99
          }
        }'
