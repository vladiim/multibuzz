<div class="min-h-screen bg-gray-100">
  <nav class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex">
          <div class="flex-shrink-0 flex items-center gap-3">
            <div class="p-1.5">
              <svg width="24" height="24" viewBox="0 0 963 963" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: block;">
                <path d="M60.2819 352C36.0202 352 14.0154 362.255 4.6117 378.033C-4.79205 393.811 0.474051 411.823 17.7769 423.788L361.202 664.001V814.809C361.202 825.984 367.596 836.634 378.881 844.523L499.249 928.67C516.552 940.766 542.318 944.316 564.887 937.742C587.456 931.168 601.938 915.917 601.938 898.956V664.001L945.363 423.919C962.666 411.823 967.744 393.811 958.34 378.033C948.936 362.255 927.12 352 902.858 352H60.2819Z" fill="#1F2937"/>
                <rect x="57" y="120" width="199" height="210" rx="6" fill="#6366F1"/>
                <rect x="290" y="49" width="177" height="153" rx="8" fill="#EC4899"/>
                <rect x="501" y="3" width="175" height="273" rx="8" fill="#10B981"/>
                <rect x="710" y="172" width="207" height="158" rx="6" fill="#F59E0B"/>
              </svg>
            </div>
            <h1 class="text-2xl font-bold text-gray-900">mbuzz</h1>
          </div>
          <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
            <%= link_to "Dashboard", dashboard_path, class: "border-b-2 border-indigo-500 text-gray-900 inline-flex items-center px-1 pt-1 text-sm font-medium" %>
            <%= link_to "API Keys", dashboard_api_keys_path, class: "text-gray-500 hover:text-gray-900 inline-flex items-center px-1 pt-1 text-sm font-medium" %>
          </div>
        </div>
        <div class="flex items-center">
          <span class="text-gray-700 mr-4"><%= current_user.email %></span>
          <%= button_to "Logout", logout_path, method: :delete, class: "text-gray-700 hover:text-gray-900" %>
        </div>
      </div>
    </div>
  </nav>

  <div class="py-10">
    <header>
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-3xl font-bold leading-tight text-gray-900">Dashboard</h1>
        <p class="mt-2 text-sm text-gray-600">Account: <%= @account.name %></p>
      </div>
    </header>
    <main>
      <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
        <!-- Stats Grid -->
        <div class="mt-8 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
          <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
              <dt class="text-sm font-medium text-gray-500 truncate">Total Events</dt>
              <dd class="mt-1 text-3xl font-semibold text-gray-900"><%= number_with_delimiter(@stats[:total_events]) %></dd>
            </div>
          </div>
          <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
              <dt class="text-sm font-medium text-gray-500 truncate">Total Visitors</dt>
              <dd class="mt-1 text-3xl font-semibold text-gray-900"><%= number_with_delimiter(@stats[:total_visitors]) %></dd>
            </div>
          </div>
          <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
              <dt class="text-sm font-medium text-gray-500 truncate">Total Sessions</dt>
              <dd class="mt-1 text-3xl font-semibold text-gray-900"><%= number_with_delimiter(@stats[:total_sessions]) %></dd>
            </div>
          </div>
          <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
              <dt class="text-sm font-medium text-gray-500 truncate">Events Today</dt>
              <dd class="mt-1 text-3xl font-semibold text-gray-900"><%= number_with_delimiter(@stats[:events_today]) %></dd>
            </div>
          </div>
        </div>

        <!-- UTM Breakdown -->
        <div class="mt-8">
          <div class="bg-white shadow overflow-hidden sm:rounded-lg">
            <div class="px-4 py-5 sm:px-6">
              <h3 class="text-lg leading-6 font-medium text-gray-900">Top UTM Campaigns</h3>
            </div>
            <div class="border-t border-gray-200">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Source</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Medium</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Campaign</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Events</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <% @utm_breakdown.each do |utm| %>
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= utm[:utm_source] %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= utm[:utm_medium] %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= utm[:utm_campaign] %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= number_with_delimiter(utm[:count]) %></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Recent Events -->
        <div class="mt-8">
          <div class="bg-white shadow overflow-hidden sm:rounded-lg">
            <div class="px-4 py-5 sm:px-6">
              <h3 class="text-lg leading-6 font-medium text-gray-900">Recent Events</h3>
            </div>
            <div class="border-t border-gray-200">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">URL</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">UTM Source</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Occurred</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <% @recent_events.each do |event| %>
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= event.event_type %></td>
                      <td class="px-6 py-4 text-sm text-gray-500 truncate max-w-xs"><%= event.url %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= event.utm_source || "-" %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= time_ago_in_words(event.occurred_at) %> ago</td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>
